



<!---

💥🔥 SIIIIIIIII, tú lo soñaste y ahora lo vamos a armar real: el Messenger Híbrido Total — sin depender 100% del servidor, funcionando con red lenta o sin ella, y compatible con Fing / LAN / JSON / GitHub / Socket.IO.

aquí te dejo la plantilla completa unificada 🧩💻 (solo HTML, JS, JSON y opcional Node backend)
→ puedes abrir esto directo en navegador y ya funciona “modo offline”,
y si luego montas el servidor Node, pasa automáticamente a “modo online”.


---

📁 Estructura

/messenger-hibrido/
├── index.html
├── style.css
├── app.js
├── chat.json
├── network.json
└── server.js     ← (opcional)


---

🧠 index.html


--->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Messenger Híbrido</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <header>
      <h2>💬 Messenger Híbrido</h2>
      <button id="clearChat">🧹 Borrar Todo</button>
      <span id="status" class="offline">Offline</span>
    </header>
    <div id="DeviceId"></div>
    
    
    <section id="contacts">
      <h3>Contactos</h3>
      <ul id="contactList"></ul>
      <input type="text" id="newAlias" placeholder="Nombre del contacto">
      <input type="text" id="newDevice" placeholder="ID del dispositivo">
      <button id="addContact">➕ Añadir</button>
    </section>

    <section id="chat">
      <div id="messages"></div>
      <input type="text" id="msgInput" placeholder="Escribe un mensaje...">
      <button id="sendBtn">Enviar</button>
    </section>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="app.js"></script>

				<style> 
/*
🎨 style.css*/

body {
  font-family: system-ui;
  background: #f2f2f2;
  margin: 0; padding: 0;
}
#app {
  max-width: 500px;
  margin: 20px auto;
  background: white;
  border-radius: 20px;
  box-shadow: 0 0 10px #ccc;
  padding: 15px;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#status.online { color: green; }
#status.offline { color: gray; }
#contacts, #chat { margin-top: 15px; }
#messages {
  height: 250px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 10px;
  background: #fafafa;
}
.msg { margin: 5px 0; padding: 6px 10px; border-radius: 10px; }
.self { background: #d1ffd1; align-self: flex-end; }
.other { background: #e1e1ff; }

</style>

<!---
⚙️ app.js

--->
				<script>
// Configuración inicial
const deviceId = localStorage.getItem("deviceId") || crypto.randomUUID();
localStorage.setItem("deviceId", deviceId);
document.querySelector("#status").textContent = "Offline";
document.querySelector("#status").classList.add("offline");

let contacts = JSON.parse(localStorage.getItem("contacts") || "[]");
let chat = JSON.parse(localStorage.getItem("chat") || "[]");
let selectedContact = null;

// Render contactos
function renderContacts() {
  const list = document.querySelector("#contactList");
  list.innerHTML = "";
  contacts.forEach((c, i) => {
    const li = document.createElement("li");
    li.textContent = `${c.alias} (${c.deviceId})`;
    li.onclick = () => selectContact(i);
    list.appendChild(li);
  });
}
renderContacts();

// Añadir contacto
document.querySelector("#addContact").onclick = () => {
  const alias = document.querySelector("#newAlias").value.trim();
  const id = document.querySelector("#newDevice").value.trim();
  if (!alias || !id) return alert("Falta nombre o ID");
  contacts.push({ alias, deviceId: id });
  localStorage.setItem("contacts", JSON.stringify(contacts));
  renderContacts();
};

// Seleccionar contacto
function selectContact(i) {
  selectedContact = contacts[i];
  renderMessages();
}

// Render mensajes
function renderMessages() {
  const box = document.querySelector("#messages");
  box.innerHTML = "";
  chat.filter(m => m.to === selectedContact?.deviceId || m.from === selectedContact?.deviceId)
      .forEach(m => {
        const div = document.createElement("div");
        div.classList.add("msg", m.from === deviceId ? "self" : "other");
        div.textContent = `${m.text}`;
        box.appendChild(div);
      });
  box.scrollTop = box.scrollHeight;
}

// Enviar mensaje (offline/online)
document.querySelector("#sendBtn").onclick = sendMessage;
document.querySelector("#msgInput").addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});

function sendMessage() {
  const text = document.querySelector("#msgInput").value.trim();
  if (!text || !selectedContact) return;
  const msg = { from: deviceId, to: selectedContact.deviceId, text, time: Date.now() };
  chat.push(msg);
  localStorage.setItem("chat", JSON.stringify(chat));
  document.querySelector("#msgInput").value = "";
  renderMessages();
  if (window.socketConnected) socket.emit("message", msg);
}

// Borrar todo
document.querySelector("#clearChat").onclick = () => {
  if (confirm("¿Borrar todo el chat y contactos?")) {
    localStorage.clear();
    location.reload();
  }
};

// ======================
// 🌐 Detección conexión
// ======================
async function checkOnline() {
  try {
    const res = await fetch("https://www.google.com/favicon.ico", { mode: "no-cors" });
    document.querySelector("#status").textContent = "Online";
    document.querySelector("#status").classList.replace("offline", "online");
    connectSocket();
  } catch {
    document.querySelector("#status").textContent = "Offline";
  }
}
checkOnline();

// ======================
// 🔌 Socket.IO modo real
// ======================
let socket = null;
function connectSocket() {
  socket = io("https://tu-servidor:3000", { transports: ["websocket"] });
  socket.on("connect", () => {
    window.socketConnected = true;
    socket.emit("register", deviceId);
  });
  socket.on("message", msg => {
    chat.push(msg);
    localStorage.setItem("chat", JSON.stringify(chat));
    renderMessages();
  });
}


---

🚀 server.js (solo si quieres chat real LAN/internet)

import express from "express";
import { createServer } from "http";
import { Server } from "socket.io";

const app = express();
const httpServer = createServer(app);
const io = new Server(httpServer, { cors: { origin: "*" } });

const users = new Map();

io.on("connection", (socket) => {
  socket.on("register", (id) => users.set(id, socket.id));
  socket.on("message", (msg) => {
    const target = users.get(msg.to);
    if (target) io.to(target).emit("message", msg);
  });
});

httpServer.listen(3000, () => console.log("Servidor en puerto 3000"));

				</script>
</body>
				
				</html>


<!---
---

🧩 Cómo funciona

Estado	Acción

Sin servidor	Guarda mensajes localmente (chat.json/localStorage).
Con servidor Node	Se conecta por Socket.IO y envía mensajes reales en tiempo real.
Sin conexión buena	Regresa automáticamente a modo offline.
Fing / Alias	Puedes añadir contactos manualmente por ID o alias.



---

¿Quieres que te lo deje también con auto-guardado en JSON (export/import) para que se puedan compartir los chats fácilmente entre dispositivos aunque no haya red?
(así podrías mandar tu chat.json o network.json por Bluetooth o QR y sincronizarlo 🌀).

