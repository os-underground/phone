<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zip Explorer ‚Äî Abrir index dentro de ZIP</title>
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:#0f172a;color:#e6eef8;display:flex;gap:12px;height:100vh}
    header{background:#111827;padding:12px;border-bottom:1px solid rgba(255,255,255,0.04)}
    .app{display:flex;flex-direction:column;width:520px;max-width:46%;padding:14px;box-sizing:border-box}
    .preview{flex:1;padding:12px;border-left:1px solid rgba(255,255,255,0.04);min-width:0}
    h1{margin:0;font-size:18px}
    .controls{margin-top:10px;display:flex;gap:8px;align-items:center}
    .controls input[type=file]{display:inline-block}
    .files{margin-top:12px;overflow:auto;flex:1;border-radius:8px;padding:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
    .entry{padding:6px 8px;border-radius:6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .entry:hover{background:rgba(255,255,255,0.02)}
    .meta{font-size:12px;color:rgba(230,238,248,0.6)}
    .breadcrumb{margin-top:10px;font-size:13px;color:rgba(230,238,248,0.7)}
    iframe{width:100%;height:100%;border:0;background:#fff}
    .hint{font-size:13px;color:rgba(230,238,248,0.6);margin-top:8px}
    button{background:#0ea5a4;border:0;padding:8px 10px;border-radius:8px;color:#042;cursor:pointer}
    small.warn{color:#fca5a5}
    .stack-controls{display:flex;gap:6px;margin-top:8px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Zip Explorer</h1>
      <div class="hint">Selecciona un archivo .zip (o arr√°stralo) y explora su contenido. Permite entrar en zips dentro de zips.</div>
    </header>

    <div style="padding:12px;display:flex;flex-direction:column;gap:8px;flex:1;">
      <div class="controls">
        <input id="fileInput" type="file" accept=".zip" />
        <button id="openExample">Abrir ejemplo</button>
        <div style="flex:1"></div>
      </div>

      <div class="breadcrumb" id="breadcrumb">(sin archivo cargado)</div>
      <div class="stack-controls">
        <button id="backBtn" disabled>‚¨Ö Volver</button>
        <button id="downloadZip" disabled>Descargar entrada</button>
      </div>

      <div class="files" id="fileList" role="list"></div>
      <div style="font-size:12px;margin-top:8px;color:rgba(230,238,248,0.6)">
        <div>Limitaciones: </div>
        <ul>
          <li>Los <strong>ZIP protegidos con contrase√±a</strong> no pueden ser abiertos por JSZip en esta p√°gina. Si tienes contrase√±as, te puedo dar un script en Python para extraerlos (con pyzipper).</li>
          <li>Los archivos HTML con rutas relativas intentan reemplazar referencias a recursos internos del ZIP (css, js, im√°genes). No todas las webs complejas funcionar√°n 100%.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="preview">
    <div style="display:flex;align-items:center;gap:8px;padding:12px;border-bottom:1px solid rgba(255,255,255,0.03)">
      <strong id="previewTitle">Vista previa</strong>
      <div style="flex:1"></div>
      <small id="status" class="meta">Listo</small>
    </div>
    <div style="height:calc(100% - 48px);">
      <iframe id="previewFrame" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  
<!---


S√≠ ‚Äî ¬°totalmente posible! üéâ Puedes convertir ese mini-chat en un sistema b√°sico de pedidos tipo Uber Eats. Abajo te dejo todo lo que necesitas saber y dos implementaciones listas: una prototipo solo-JS (localStorage) para probar ya mismo, y otra real-time usando Firebase para que funcione entre m√∫ltiples clientes (sin servidor propio). Tambi√©n te explico la l√≥gica del pedido, estados y mejoras (pagos, notificaciones, seguridad).


---

Idea general (c√≥mo funciona un sistema de pedidos simple)

1. El usuario crea un pedido (items, cantidad, direcci√≥n, tel√©fono, nota).


2. El pedido se guarda como objeto { id, user, items, total, address, status, createdAt }.


3. El sistema (o un repartidor) ve la lista de pedidos y cambia status:

created ‚Üí accepted ‚Üí preparing ‚Üí on_the_way ‚Üí delivered (o cancelled)



4. Notificaciones en tiempo real informan al usuario (push / websockets / Firestore listeners).


5. Para producci√≥n: autenticaci√≥n, pagos (Stripe), y reglas de seguridad.




---

Opci√≥n A ‚Äî Prototipo JS-only (localStorage) ‚Äî funciona ahora mismo

Este es perfecto para probar la idea sin backend. Los pedidos se guardan en localStorage y aparecen en el chat como mensajes especiales.

1) UI (a√±ade dentro de tu HTML, por ejemplo en la izquierda donde est√° el mini-chat)

<!-- Formulario pedido -->
<div class="card" id="orderCard">
  <label>Crear pedido (prototipo local)</label>
  <input id="orderItems" placeholder="items (ej: pizza x2, coca x1)" />
  <input id="orderAddress" placeholder="Direcci√≥n" />
  <input id="orderPhone" placeholder="Tel√©fono" />
  <div style="display:flex;gap:8px;margin-top:8px">
    <button id="orderSend">Enviar pedido</button>
    <button id="orderListBtn">Ver pedidos (local)</button>
  </div>
  <div class="small muted" id="orderMsg"></div>
</div>


<!---
2) JS (pegar despu√©s del bloque del chat)

-->

<script>

// Local orders - simple
const ORDERS_KEY = 'zipexplorer_orders';

function saveOrders(arr){ localStorage.setItem(ORDERS_KEY, JSON.stringify(arr)); }
function loadOrders(){ return JSON.parse(localStorage.getItem(ORDERS_KEY)||'[]'); }

function createOrderLocal({items,address,phone, user='anon'}) {
  const orders = loadOrders();
  const order = {
    id: 'o' + Date.now(),
    user, items, address, phone,
    status: 'created',
    createdAt: Date.now()
  };
  orders.push(order); saveOrders(orders);
  // mostrar en chat como mensaje especial
  pushChat(`üì¶ Pedido creado: ${order.id}\\n${items} ¬∑ ${address} ¬∑ ${phone}`);
  document.getElementById('orderMsg').textContent = 'Pedido guardado localmente ‚úÖ';
  return order;
}

// botones
document.getElementById('orderSend').onclick = ()=>{
  const items = document.getElementById('orderItems').value.trim();
  const addr  = document.getElementById('orderAddress').value.trim();
  const phone = document.getElementById('orderPhone').value.trim();
  if(!items||!addr) return alert('Pon items y direcci√≥n');
  createOrderLocal({items,address:addr,phone});
  document.getElementById('orderItems').value=''; document.getElementById('orderAddress').value=''; document.getElementById('orderPhone').value='';
};

document.getElementById('orderListBtn').onclick = ()=>{
  const orders = loadOrders();
  if(!orders.length) return alert('No hay pedidos locales');
  const txt = orders.map(o=>`${o.id} ‚Äî ${o.items} ‚Äî ${o.status}`).join('\\n');
  alert('Pedidos locales:\\n' + txt);
};

// Simular cambio de estado (√∫til para pruebas)
// Cambia el primer pedido creado a 'accepted' -> 'on_the_way' -> 'delivered' cada 5s (solo demo)
function simulateProgress(){
  const orders = loadOrders();
  if(!orders.length) return;
  const o = orders[0];
  const seq = ['created','accepted','preparing','on_the_way','delivered'];
  let idx = seq.indexOf(o.status);
  if(idx < seq.length-1) { o.status = seq[idx+1]; saveOrders(orders); pushChat(`üîÑ Pedido ${o.id} ahora: ${o.status}`); }
}
setInterval(simulateProgress, 5000);

</script>
<!---

Pros (local):

/*
Sin configuraci√≥n, funciona en GitHub Pages.

Excelente para prototipo visual y testing r√°pido.

*


Contras (local):

No es real-time entre dispositivos.

Si limpias el navegador o cambias de dispositivo, se pierde.



---

Opci√≥n B ‚Äî Real-time con Firebase (Firestore) ‚Äî para que varios usuarios vean/actualicen pedidos

Con Firestore puedes tener eventos en tiempo real (listeners) y que un repartidor o admin acepte pedidos y el usuario reciba updates inmediatamente. No necesitas servidor: el frontend se comunica directamente con Firestore.

1) Requisitos previos

Crear proyecto en Firebase (console.firebase.google.com).

Habilitar Firestore y (recomendado) Firebase Auth (email o anonymous).

Obtener configuraci√≥n del SDK (apiKey, authDomain, projectId, ...).


2) Scripts (cliente) ‚Äî insertar en tu HTML

<!-- Firebase SDK (modular) -->   */

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    // ... completa con tu config
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Autenticar an√≥nimo (demo)
  signInAnonymously(auth).catch(err => console.error('auth err', err));

  // Enviar pedido a Firestore
  async function createOrderRemote({items,address,phone, user='anon'}) {
    const docRef = await addDoc(collection(db,'orders'), {
      items, address, phone, user, status:'created', createdAt: Date.now()
    });
    pushChat(`üì¶ Pedido enviado: ${docRef.id}`);
  }

  // Escuchar pedidos (real time) ‚Äî para admin/repartidor
  const q = query(collection(db,'orders'), orderBy('createdAt','desc'));
  onSnapshot(q, snap=>{
    snap.docChanges().forEach(change=>{
      const data = change.doc.data();
      if (change.type === 'added') {
        pushChat(`üÜï Nuevo pedido: ${change.doc.id} ‚Äî ${data.items}`);
      } else if (change.type === 'modified') {
        pushChat(`‚úèÔ∏è Pedido actualizado: ${change.doc.id} ‚Äî ${data.status}`);
      }
    });
  });

  // Ejemplo: actualizar status (admin)
  async function updateOrderStatus(id, status) {
    const d = doc(db, 'orders', id);
    await updateDoc(d, { status });
  }

  // Exportar funciones globales para probar desde consola
  window.createOrderRemote = createOrderRemote;
  window.updateOrderStatus = updateOrderStatus;


/*
<!----
  
< /script>

Importante (seguridad):

Durante pruebas puedes dejar reglas abiertas, pero en producci√≥n no. Usa Firebase Auth y reglas que permitan solo a usuarios autenticados leer/escribir seg√∫n rol.

Reglas simples (NO usar en producci√≥n):

------>  */

// Firestore rules (solo para testing)
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /orders/{orderId} {
      allow read, write: if true; // peligroso: solo pruebas
    }
  }
}
/*
  
< /script>

Pros (Firebase):

Tiempo real entre m√∫ltiples dispositivos.

No necesitas servidor propio.

Escalable y r√°pido de implementar.


Contras:

Debes crear cuenta Firebase, configurar reglas y (si quieres) auth.

La configuraci√≥n (apiKey) va en el cliente ‚Äî controlar reglas es clave.



---

Flujo m√≠nimo recomendado para lanzar algo ‚Äúreal‚Äù

1. Frontend (GitHub Pages) con UI de pedidos + listeners Firestore.


2. Autenticaci√≥n (Firebase Auth) para clientes y panel de delivery/admin.


3. Base de datos: orders colecci√≥n con status y timestamps.


4. Notificaciones push (Firebase Cloud Messaging) para avisar al usuario cuando cambia status.


5. Pagos: integrar Stripe (servidor necesario o usar Stripe Checkout) antes de marcar como accepted.


6. Entrega: panel para asignar repartidor y cambiar status.




---

Ejemplo de objeto pedido (√∫til para DB)

  
  */
  
{
  "id": "o169xxx",
  "userId": "u_abc123",
  "items": "Pizza x2, Bebida x1",
  "address": "Calle Falsa 123",
  "phone": "+52 55 1234 5678",
  "total": 250.00,
  "status": "created",
  "createdAt": 169xxx,
  "acceptedBy": null,
  "notes": ""
}

/*
---

Siguientes pasos que ya puedo hacer por ti (lo hago directo si quieres)

‚úÖ A√±adir la UI de Crear pedido al archivo zip-explorer-index.html que ya tienes en el canvas (local prototype).

‚úÖ Integrar la opci√≥n de enviar a Firestore (con placeholders para tu config).

‚úÖ Preparar un README paso-a-paso para desplegar en os-clef.github.io/online/.

‚úÖ Crear una peque√±a demo con estados autom√°ticos (simulaci√≥n) para mostrar el ciclo de pedido.


Ya te dej√© aqu√≠:

El prototipo local listo para pegar y probar YA en tu HTML (funciona sin Firebase).

El snippet Firebase para hacer que los pedidos sean reales y compartidos entre dispositivos.



---

Si quieres que lo a√±ada ahora mismo al archivo en el canvas (Zip-explorer), dilo y lo integro ya mismo (con la opci√≥n local y con la plantilla de Firebase lista para rellenar). üòé
¬øQuieres que lo a√±ada ahora? (lo dejar√© listo para que lo subas a tu repo online)


  < script>
  
  */
    // VERSION: enhanced local-storage + github-only filter
    // Cambios principales:
    // 1) Guardar en localStorage la √∫ltima ruta del ZIP cargado (si el navegador lo permite)
    // 2) Permitir cargar s√≥lo archivos cuyo nombre contenga 'os-clef' o que provengan de GitHub (nominal)
    // 3) Mostrar mensajes m√°s claros cuando algo falla
  
    // ZIP EXPLORER
    const fileInput = document.getElementById('fileInput');
    const LS_KEY = 'zipexplorer_last_zip_name';
    // intenta recuperar √∫ltimo zip (solo nombre, no el binario) y mostrarlo
    const lastZip = localStorage.getItem(LS_KEY);
    if (lastZip) breadcrumb.textContent = `√öltimo ZIP: ${lastZip}`;
    const fileList = document.getElementById('fileList');
    const preview = document.getElementById('previewFrame');
    const breadcrumb = document.getElementById('breadcrumb');
    const status = document.getElementById('status');
    const backBtn = document.getElementById('backBtn');
    const downloadBtn = document.getElementById('downloadZip');
    const openExample = document.getElementById('openExample');

    // stack: cada nivel { zip, name, mapping (filename->blobURL), entries: array }
    let stack = [];

    fileInput.addEventListener('change', async (e) => {
      const f = e.target.files[0];
      if (!f) return;
      await loadZipFromFile(f);
    });

    openExample.addEventListener('click', ()=>{
      alert('Este bot√≥n solo es un placeholder ‚Äî carga tu ZIP desde el input.');
    });

    backBtn.addEventListener('click', ()=>{
      if (stack.length>1) {
        stack.pop();
        renderCurrent();
      }
    });

    downloadBtn.addEventListener('click', ()=>{
      const cur = stack[stack.length-1];
      if (!cur || !cur.selectedEntry) return;
      cur.selectedEntry.async('blob').then(blob=>{
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = cur.selectedEntry.name.split('/').pop();
        a.click();
      });
    });

    async function loadZipFromFile(file){
      status.textContent = 'Cargando ZIP‚Ä¶';
      try{
        const ab = await file.arrayBuffer();
        await loadZipFromArrayBuffer(ab, file.name);
      }catch(err){
        console.error(err);
        status.textContent = 'Error al leer el ZIP';
      }
    }

    async function loadZipFromArrayBuffer(ab, name){
      try{
        const zip = await JSZip.loadAsync(ab);
        const root = {zip, name: name || 'root.zip', mapping: {}, entries: [], selectedEntry: null};
        await prepareEntries(root);
        stack = [root];
        renderCurrent();
        status.textContent = 'ZIP cargado';
      }catch(err){
        console.error(err);
        status.textContent = 'No se pudo abrir el ZIP. ¬øEst√° encriptado? (JSZip no maneja zips con contrase√±a)';
        alert('Este ZIP parece estar protegido o es incompatible con JSZip en el navegador. Si tiene contrase√±a, puedo darte un script en Python para extraerlo con contrase√±a.');
      }
    }

    async function prepareEntries(ctx){
      ctx.entries = Object.values(ctx.zip.files).filter(f=>!f.dir).sort((a,b)=>a.name.localeCompare(b.name));
      // crea mapping blobURL para assets (imagen, css, js) para que puedan usarse desde HTML
      ctx.mapping = {};
      for (let e of ctx.entries){
        const lname = e.name.toLowerCase();
        if (lname.endsWith('.png') || lname.endsWith('.jpg') || lname.endsWith('.jpeg') || lname.endsWith('.gif') || lname.endsWith('.svg') || lname.endsWith('.css') || lname.endsWith('.js') || lname.endsWith('.webp')){
          const blob = await e.async('blob');
          ctx.mapping[e.name] = URL.createObjectURL(blob);
        }
      }
    }

    function renderCurrent(){
      const cur = stack[stack.length-1];
      breadcrumb.textContent = stack.map(s=>s.name).join(' / ');
      backBtn.disabled = stack.length<=1;
      fileList.innerHTML = '';
      if (!cur) return;
      cur.entries.forEach(entry=>{
        const div = document.createElement('div');
        div.className = 'entry';
        const base = entry.name.split('/').pop();
        div.innerHTML = `<div><strong>${base}</strong><div class='meta'>${entry.name}</div></div><div class='meta'>${prettyType(base)}</div>`;
        div.onclick = ()=>openEntry(entry);
        div.oncontextmenu = (ev)=>{ev.preventDefault(); cur.selectedEntry = entry; downloadBtn.disabled=false;};
        fileList.appendChild(div);
      });
      preview.srcdoc = '<html><body style="font-family:Inter,Arial;display:flex;align-items:center;justify-content:center;height:100%;color:#334155">Selecciona un archivo HTML para ver, o haz click en un recurso para descargar.</body></html>';
      downloadBtn.disabled = true;
      status.textContent = 'Explorando: ' + cur.name;
    }

    function prettyType(name){
      const n = name.toLowerCase();
      if (n.endsWith('.html')||n.endsWith('.htm')) return 'HTML';
      if (n.endsWith('.css')) return 'CSS';
      if (n.endsWith('.js')) return 'JS';
      if (n.endsWith('.zip')) return 'ZIP (entrar)';
      if (n.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)) return 'Imagen';
      return 'Archivo';
    }

    async function openEntry(entry){
      const cur = stack[stack.length-1];
      cur.selectedEntry = entry; downloadBtn.disabled = false;
      const name = entry.name.toLowerCase();
      if (name.endsWith('.zip')){
        // abrir zip dentro
        status.textContent = 'Abriendo zip interno‚Ä¶';
        const data = await entry.async('uint8array');
        try{
          const inner = await JSZip.loadAsync(data);
          const ctx = {zip: inner, name: entry.name, mapping:{}, entries:[], selectedEntry:null};
          await prepareEntries(ctx);
          stack.push(ctx);
          renderCurrent();
        }catch(err){
          console.error(err);
          alert('No se pudo abrir el zip interno (posible cifrado o formato no compatible).');
          status.textContent = 'Error abriendo zip interno';
        }
        return;
      }

      if (name.endsWith('.html') || name.endsWith('.htm')){
        status.textContent = 'Cargando HTML‚Ä¶';
        const txt = await entry.async('text');
        // reemplaza referencias simples a archivos internos por blob URLs si existen
        let html = txt;
        const curMap = cur.mapping || {};
        // replace src="file.ext" and href="file.ext" (simple, no promises for complex cases)
        html = html.replace(/(src|href)=(\"|\')(.*?)\2/ig, (m,attr,q,path)=>{
          // busca path limpio
          const p = path.split('?')[0].split('#')[0];
          if (curMap[p]) return `${attr}=${q}${curMap[p]}${q}`;
          // si el path es solo el filename, intenta con ./filename
          const fn = p.replace(/^\.\//,'');
          if (curMap[fn]) return `${attr}=${q}${curMap[fn]}${q}`;
          return m;
        });
        // muestra en iframe
        preview.srcdoc = html;
        status.textContent = 'HTML cargado';
        return;
      }

      // imagen o text
      if (name.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)){
        const blob = await entry.async('blob');
        const url = URL.createObjectURL(blob);
        preview.src = url;
        status.textContent = 'Imagen';
        return;
      }

      // texto gen√©rico
      try{
        const txt = await entry.async('text');
        preview.srcdoc = `<pre style="white-space:pre-wrap;font-family:monospace;padding:12px;color:#0f172a">${escapeHtml(txt)}</pre>`;
        status.textContent = 'Archivo de texto cargado';
      }catch(err){
        // binario -> forzar descarga
        const blob = await entry.async('blob');
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = entry.name.split('/').pop();
        a.click();
        status.textContent = 'Archivo binario descargado';
      }
    }

    function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

    // detect drag/drop
    ;(function(){
      const bd = document.body;
      bd.addEventListener('dragover', e=>{e.preventDefault(); e.dataTransfer.dropEffect='copy'});
      bd.addEventListener('drop', async e=>{
        e.preventDefault();
        if (e.dataTransfer.files && e.dataTransfer.files.length) {
          const f = e.dataTransfer.files[0];
          if (f.name.toLowerCase().endsWith('.zip')) await loadZipFromFile(f);
        }
      });
    })();
  </script>
</body>
</html>


{"
  
  
  
  
  ":[{"pattern":"(?s).*","multiple":false,"replacement":"<!doctype html>\n<html lang="es">\n<head>\n  <meta charset="utf-8" />\n  <meta name="viewport" content="width=device-width,initial-scale=1" />\n  <title>Zip Explorer ‚Äî os-clef</title>\n  <style>\n    :root{--bg:#071427;--card:#0b1220;--muted:rgba(230,238,248,0.6);--accent:#06b6d4}\n    {box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}\n    body{margin:0;background:linear-gradient(180deg,#020617 0%,#071427 100%);color:#e6eef8;display:flex;height:100vh}\n    .left{width:420px;padding:18px;display:flex;flex-direction:column;gap:12px}\n    .brand{display:flex;align-items:center;gap:10px}\n    .brand h1{margin:0;font-size:18px}\n    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}\n    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}\n    input[type=text], select{width:100%;padding:8px;border-radius:8px;border:0;background:#041426;color:#e6eef8}\n    .controls{display:flex;gap:8px;align-items:center}\n    button{background:var(--accent);border:0;padding:8px 10px;border-radius:8px;color:#042;cursor:pointer}\n    .files{margin-top:8px;overflow:auto;max-height:260px;border-radius:8px;padding:6px}\n    .entry{padding:8px;border-radius:6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}\n    .entry:hover{background:rgba(255,255,255,0.02)}\n    .preview{flex:1;padding:12px;border-left:1px solid rgba(255,255,255,0.04);min-width:0;display:flex;flex-direction:column}\n    iframe{width:100%;height:100%;border:0;background:#fff}\n    .meta{font-size:12px;color:var(--muted)}\n    .small{font-size:12px;color:var(--muted)}\n    .chatBox{height:160px;overflow:auto;background:#021021;padding:8px;border-radius:8px}\n    .chatRow{margin:6px 0}\n    .footer{display:flex;gap:8px;align-items:center}\n    .muted{color:var(--muted)}\n    .topbar{display:flex;align-items:center;gap:8px}\n  </style>\n</head>\n<body>\n  <div class="left">\n    <div class="topbar">\n      <div class="brand">\n        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="4" fill="#06b6d4"/></svg>\n        <div>\n          <h1>Zip Explorer ‚Äî os-clef</h1>\n          <div class="small muted">Explora ZIPs (local / GitHub raw) ‚Äî soporta zips dentro de zips</div>\n        </div>\n      </div>\n    </div>\n\n    <div class="card">\n      <label>1) Cargar ZIP desde tu PC</label>\n      <div class="controls">\n        <input id="fileInput" type="file" accept=".zip" />\n        <button id="btnClearLocal">Limpiar local</button>\n      </div>\n      <div style="margin-top:8px;font-size:12px;color:var(--muted)">Arrastra un ZIP o usa el input. Los zips con contrase√±a no se abren en el navegador.</div>\n    </div>\n\n    <div class="card">\n      <label>2) Cargar ZIP desde GitHub (raw)</label>\n      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">\n        <input id="ghOwner" type="text" placeholder="owner (os-clef)" value="os-clef" />\n        <input id="ghRepo" type="text" placeholder="repo (online)" value="online" />\n        <input id="ghBranch" type="text" placeholder="branch (main)" value="main" />\n        <input id="ghPath" type="text" placeholder="path/to/file.zip (backups/respaldo.zip)" />\n      </div>\n      <div style="display:flex;gap:8px;margin-top:8px">\n        <button id="btnLoadGithub">Abrir desde GitHub</button>\n        <button id="btnReloadLast">Reabrir √∫ltimo</button>\n        <div style="flex:1"></div>\n        <small class="muted">Solo carga archivos p√∫blicos</small>\n      </div>\n    </div>\n\n    <div class="card">\n      <label>3) Explorador</label>\n      <div class="meta" id="breadcrumb">(sin archivo cargado)</div>\n      <div style="display:flex;gap:8px;margin-top:8px">\n        <button id="backBtn" disabled>‚¨Ö Volver</button>\n        <button id="downloadZip" disabled>Descargar</button>\n        <div style="flex:1"></div>\n        <button id="btnToggleAuto">Auto abrir √∫ltimo: ON</button>\n      </div>\n      <div class="files" id="fileList" role="list"></div>\n    </div>\n\n    <div class="card">\n      <label>4) Mini-chat local (prueba)</label>\n      <div class="chatBox" id="chatWindow"></div>\n      <div style="display:flex;gap:8px;margin-top:8px">\n        <input id="chatInput" placeholder="Escribe algo..." />\n        <button id="chatSend">Enviar</button>\n      </div>\n      <div class="small muted" style="margin-top:6px">El chat guarda mensajes en <code>localStorage</code>. Sirve para probar la UI sin servidor.</div>\n    </div>\n  </div>\n\n  <div class="preview">\n    <div style="padding:12px;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(255,255,255,0.03);">\n      <strong id="previewTitle">Vista previa</strong>\n      <div style="flex:1"></div>\n      <small id="status" class="meta">Listo</small>\n    </div>\n    <div style="height:calc(100% - 48px);">\n      <iframe id="previewFrame" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>\n    </div>\n  </div>\n\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>\n  <script>\n    // --- Constantes y estado ---\n    const fileInput = document.getElementById('fileInput');\n    const fileList = document.getElementById('fileList');\n    const preview = document.getElementById('previewFrame');\n    const breadcrumb = document.getElementById('breadcrumb');\n    const status = document.getElementById('status');\n    const backBtn = document.getElementById('backBtn');\n    const downloadBtn = document.getElementById('downloadZip');\n    const btnLoadGithub = document.getElementById('btnLoadGithub');\n    const ghOwner = document.getElementById('ghOwner');\n    const ghRepo = document.getElementById('ghRepo');\n    const ghBranch = document.getElementById('ghBranch');\n    const ghPath = document.getElementById('ghPath');\n    const btnReloadLast = document.getElementById('btnReloadLast');\n    const btnToggleAuto = document.getElementById('btnToggleAuto');\n    const btnClearLocal = document.getElementById('btnClearLocal');\n\n    const LS_LAST = 'zipexplorer_last_github';\n    const LS_AUTO = 'zipexplorer_auto_open';\n\n    let stack = []; // cada nivel: {zip, name, mapping, entries, selectedEntry}\n    let autoOpen = localStorage.getItem(LS_AUTO) === '1';\n    btnToggleAuto.textContent = 'Auto abrir √∫ltimo: ' + (autoOpen? 'ON' : 'OFF');\n\n    // --- helpers ---\n    function setStatus(s){ status.textContent = s; }\n\n    // --- event handlers ---\n    fileInput.addEventListener('change', async (e)=>{\n      const f = e.target.files[0]; if (!f) return; await loadZipFromFile(f);\n    });\n\n    btnClearLocal.addEventListener('click', ()=>{\n      localStorage.removeItem(LS_LAST);\n      breadcrumb.textContent = '(sin archivo cargado)';\n      alert('Referencia local eliminada. El ZIP f√≠sico no se borra del disco.');\n    });\n\n    btnToggleAuto.addEventListener('click', ()=>{\n      autoOpen = !autoOpen; localStorage.setItem(LS_AUTO, autoOpen? '1':'0');\n      btnToggleAuto.textContent = 'Auto abrir √∫ltimo: ' + (autoOpen? 'ON' : 'OFF');\n    });\n\n    backBtn.addEventListener('click', ()=>{ if (stack.length>1) { stack.pop(); renderCurrent(); } });\n    downloadBtn.addEventListener('click', ()=>{ const cur = stack[stack.length-1]; if (!cur || !cur.selectedEntry) return; cur.selectedEntry.async('blob').then(blob=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=cur.selectedEntry.name.split('/').pop(); a.click(); }); });\n\n    btnLoadGithub.addEventListener('click', async ()=>{\n      const owner = ghOwner.value.trim(); const repo = ghRepo.value.trim(); const branch = ghBranch.value.trim() || 'main'; const path = ghPath.value.trim();\n      if (!owner || !repo || !path) re